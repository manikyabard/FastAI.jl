<HTML><head><title>How to augment vision data</title><link href=../../template/hugobook.css rel=stylesheet ></link><link href=../../template/ansi.css rel=stylesheet ></link><meta content=Type=text/html; charset=utf-8 http-equiv=Content-Type ></meta></head><body><input onclick=toggleMenu() id=menu-control class=hidden toggle type=checkbox ></input><input id=toc-control type=checkbox class=hidden toggle ></input><main class=container flex ><aside id=menu-container class=book-menu ><nav class=book-menu-content ><h2 id=title >FastAI.jl</h2><div id=sidebar ><div class=doctree ><body><ul><li><p><a href=../../README.md.html title= >README</a></p></li><li><p><a href=../setup.md.html title= >Setup</a></p></li><li><p><a href=../quickstart.md.html title= >Quickstart</a></p></li><li><p>Tutorials</p><ul><li><p><a href=../introduction.md.html title= >Introduction</a></p></li><li><p><a href=../data_containers.md.html title= >Data containers</a></p></li><li><p><a href=../learning_methods.md.html title= >Learning methods</a></p></li><li><p><a href=../../notebooks/serialization.ipynb.html title= >Saving and loading models</a></p></li><li><p><a href=../../tutorials/presizing.ipynb.html title= >Presizing vision datasets</a></p></li></ul></li><li><p>Learning tasks</p><ul><li><p><a href=../methods/imageclassification.md.html title= >Image classification</a></p></li><li><p><a href=../../notebooks/imagesegmentation.ipynb.html title= >Image segmentation</a></p></li><li><p><a href=../../notebooks/keypointregression.ipynb.html title= >Keypoint regression</a></p></li></ul></li><li><p>How To</p><ul><li><p><a href=../../notebooks/fitonecycle.ipynb.html title= >Train a model from scratch</a></p></li><li><p><a href=../../notebooks/finetune.ipynb.html title= >Finetune a pretrained model</a></p></li><li><p><a href=../../notebooks/lrfind.ipynb.html title= >Find a good learning rate</a></p></li><li><p><a href=augmentvision.md.html title= >Augment vision data</a></p></li><li><p><a href=../../notebooks/how_to_visualize.ipynb.html title= >Visualize data</a></p></li><li><p><a href=logtensorboard.md.html title= >Log to TensorBoard</a></p></li></ul></li><li><p>Reference</p><ul><li><p><a href=../../REFERENCE.html title= >Docstrings</a></p></li><li><p><a href=../interfaces.md.html title= >Interfaces</a></p></li><li><p><a href=../api.md.html title= >API</a></p></li><li><p><a href=../glossary.md.html title= >Glossary</a></p></li></ul></li><li><p>Background</p><ul><li><p><a href=../background/datapipelines.md.html title= >Performant data pipelines</a></p></li></ul></li></ul></body></div></div></nav></aside><div class=book-page ><header class=book-header ></header><article><h1 id=how-to-augment-vision-data >How to augment vision data</h1><p>Data augmentation is important to train models with good generalization ability, especially when the size of your dataset is limited. FastAI.jl gives you high-level helpers to use data augmentation in vision learning methods, but also allows directly using <a href=https://github.com/lorenzoh/DataAugmentation.jl title= >DataAugmentation.jl</a>, the underlying data augmentation library.</p><p>By default, the only augmentation that will be used in computer vision tasks is a random crop, meaning that after images, keypoints and masks are resized to a similar size a random portion will be cropped during training. We can demonstrate this on the image classification task.</p><div result=false output=false class=cellcontainer cell=main lang=julia ><pre result=false output=false class=codecell cell=main lang=julia ><code>using FastAI
using CairoMakie; CairoMakie.activate!(type=&quot;png&quot;)

dir = joinpath(datasetpath(&quot;dogscats&quot;), &quot;train&quot;)
data = loadtaskdata(dir, ImageClassification)
classes = Datasets.getclassesclassification(dir)
method = ImageClassification(classes, (100, 128))
xs, ys = FastAI.makebatch(method, data, fill(4, 9))
FastAI.plotbatch(method, xs, ys)
</code></pre></div><p>Most learning methods let you pass additional augmentations as keyword arguments. For example, <code>ImageClassification</code> takes the <code>aug_projection</code> and <code>aug_image</code> arguments. FastAI.jl provides the <a href=../../REFERENCE/FastAI.augs_projection.html ><code>augs_projection</code></a> helper to quickly construct a set of projective data augmentations.</p><div class=cellcontainer cell=main lang=julia ><pre class=codecell cell=main lang=julia ><code>method2 = ImageClassification(classes, (100, 128), aug_projection=augs_projection())
xs2, ys2 = FastAI.makebatch(method2, data, fill(4, 9))
f = FastAI.plotbatch(method2, xs2, ys2)
</code></pre><pre class=coderesult ><code>LoadError("string", 3, MethodError(DataLoaders._batchsize, (Float32[1.7009162 1.7009162 … -2.117904 -2.117904; 1.8036647 1.7522904 … -2.117904 -2.117904; … ; 1.5296686 1.5125438 … 1.7694151 1.7694151; 1.4954191 1.5296686 … 1.8036647 1.8036647]

Float32[1.8858544 1.8858544 … -2.0357141 -2.0357141; 1.9908963 1.9383754 … -2.0357141 -2.0357141; … ; 1.6232493 1.5357143 … 2.0084033 2.0084033; 1.6057423 1.5357143 … 2.0434172 2.0434172]

Float32[2.169412 2.1345534 … -1.8044444 -1.8044444; 2.2565577 2.186841 … -1.8044444 -1.8044444; … ; 1.8556864 1.7859696 … 2.2739873 2.2739873; 1.7859696 1.7162529 … 2.3088455 2.3088455]

Float32[1.1700488 0.9988013 … 1.8207895 1.9064132; 1.0330508 0.82755375 … 1.8721637 1.9064132; … ; 2.0262864 2.0262864 … 1.2727973 1.2899221; 2.0262864 2.0262864 … 1.4782944 1.1700488]

Float32[0.64285725 0.3452382 … 2.0609243 2.1484594; 0.78291327 0.4327732 … 2.1134453 2.1484594; … ; 2.2009804 2.2009804 … -0.092436954 0.030112052; 2.2009804 2.2009804 … 0.047619052 -0.16246496]

Float32[0.44392177 0.2870589 … 2.3262744 2.4134207; 0.6007845 0.39163405 … 2.3785625 2.4134207; … ; 2.4134207 2.4134207 … -0.2532461 -0.04409578; 2.4134207 2.4134207 … -0.18352933 -0.30553368]

Float32[1.9406626 1.9064132 … 1.7009162 2.0434113; 2.0091617 1.9064132 … 1.6324171 2.0262864; … ; -2.117904 -2.117904 … 1.4097953 1.4097953; -2.117904 -2.117904 … 1.4097953 1.42692]

Float32[2.1134453 2.0784314 … 1.9733893 2.2885156; 2.1834733 2.0784314 … 1.8858544 2.2710083; … ; -2.0357141 -2.0357141 … 1.5707283 1.5882353; -2.0357141 -2.0357141 … 1.5882353 1.6057423]

Float32[2.3262744 2.2914162 … 2.0822659 2.4831376; 2.3959913 2.2914162 … 1.9951199 2.465708; … ; -1.8044444 -1.8044444 … 1.7685405 1.7162529; -1.8044444 -1.8044444 … 1.7162529 1.7162529]

Float32[-2.117904 -2.117904 … -0.57667613 -0.5081771; -2.117904 -2.117904 … -0.8335474 -0.26843056; … ; -2.117904 -2.117904 … 0.9988013 1.1700488; -2.117904 -2.117904 … 1.1015497 1.3070468]

Float32[-2.0357141 -2.0357141 … -1.230392 -1.0728291; -2.0357141 -2.0357141 … -1.4229691 -0.827731; … ; -2.0357141 -2.0357141 … -0.24999997 -0.057422955; -2.0357141 -2.0357141 … -0.00490195 0.17016806]

Float32[-1.8044444 -1.8044444 … -0.9329847 -0.9329847; -1.8044444 -1.8044444 … -1.1421349 -0.6541175; … ; -1.8044444 -1.8044444 … -0.37525046 -0.28810447; -1.8044444 -1.8044444 … -0.14867094 -0.009237396]

Float32[2.1632845 2.1461596 … 1.3584211 1.3412963; 2.1632845 2.2146587 … 1.3412963 1.3926706; … ; 1.5296686 1.5467933 … 1.5296686 1.42692; 1.5296686 1.5810429 … 1.5296686 1.4440448]

Float32[2.3585434 2.3410363 … 1.5357143 1.5007002; 2.3410363 2.3935575 … 1.3956583 1.4481792; … ; 1.7457983 1.7808123 … 1.4131653 1.5007002; 1.7457983 1.8158263 … 1.4481792 1.5357143]

Float32[2.622571 2.5877128 … 1.4896734 1.4373858; 2.5528543 2.6051416 … 1.3328106 1.454815; … ; 2.0474076 2.0474076 … 1.3850982 1.4373858; 2.0474076 2.0822659 … 1.2282355 1.4722441]

Float32[1.4954191 1.4782944 … -2.117904 -2.117904; 1.42692 1.3755459 … -2.117904 -2.117904; … ; 1.5467933 1.3926706 … 0.6563062 0.6563062; 1.6324171 1.3926706 … 0.79330426 0.94742703]

Float32[1.4481792 1.4481792 … -2.0357141 -2.0357141; 1.4131653 1.4131653 … -2.0357141 -2.0357141; … ; 0.90546227 0.7303922 … 0.2401962 0.3277312; 0.9754903 0.74789923 … 0.50280124 0.50280124]

Float32[1.3502399 1.2630938 … -1.8044444 -1.8044444; 1.3328106 1.2979523 … -1.8044444 -1.8044444; … ; 0.5833553 0.5310677 … 0.35677567 0.23477131; 0.74021804 0.5484969 … 0.6356429 0.44392177]

Float32[1.5467933 1.5810429 … 2.1461596 2.0776608; 1.5639181 1.4440448 … 2.1461596 2.1461596; … ; 1.5981677 1.6666666 … 0.9988013 1.221423; 1.5639181 1.6666666 … 1.015926 0.7761795]

Float32[1.6407562 1.7282913 … 2.3235295 2.2535014; 1.5007002 1.4656863 … 2.3235295 2.3235295; … ; 1.6932774 1.8333333 … 0.6603642 0.88795525; 1.7457983 1.8683473 … 0.6078432 0.3452382]

Float32[1.6639653 1.7859696 … 2.535425 2.465708; 1.4373858 1.4722441 … 2.535425 2.535425; … ; 1.8556864 2.0474076 … 0.46135095 0.70535964; 1.8731157 2.0125492 … 0.47878015 0.2696297]

Float32[-0.4054286 -0.37117907 … 2.1461596 -2.117904; -0.37117907 -0.42255333 … 2.0947855 -2.117904; … ; 0.17681314 0.21106265 … 1.5639181 1.5639181; 0.12543888 0.45080918 … 1.5639181 1.5639181]

Float32[-0.792717 -0.862745 … 2.3935575 -2.0357141; -0.705182 -0.77521 … 2.3585434 -2.0357141; … ; -0.33753496 -0.21498597 … 1.6582633 1.6582633; -0.42507 0.047619052 … 1.6582633 1.6582633]

Float32[-0.82840955 -0.91555554 … 2.64 -1.8044444; -0.8109804 -0.91555554 … 2.64 -1.8044444; … ; -0.34039208 -0.20095852 … 1.8208281 1.8208281; -0.44496724 0.07790857 … 1.8208281 1.8208281]

Float32[2.0947855 2.129035 … -2.117904 -2.117904; 2.1632845 2.1632845 … -2.117904 -2.117904; … ; 1.5125438 1.4097953 … 1.5639181 1.5639181; 1.5296686 1.4611696 … 1.5467933 1.5639181]

Float32[2.3060222 2.3060222 … -2.0357141 -2.0357141; 2.3760502 2.3410363 … -2.0357141 -2.0357141; … ; 1.7282913 1.6232493 … 1.6582633 1.6582633; 1.7457983 1.6757703 … 1.6407562 1.6582633]

Float32[2.5005665 2.5179958 … -1.8044444 -1.8044444; 2.5702832 2.5528543 … -1.8044444 -1.8044444; … ; 2.0299783 1.907974 … 1.8208281 1.8208281; 2.0474076 1.9602616 … 1.8033988 1.8208281],), 0x0000000000007613))</code></pre></div><p>Likewise, there is an <a href=../../REFERENCE/FastAI.augs_lighting.html ><code>augs_lighting</code></a> helper that adds contrast and brightness augmentation:</p><div class=cellcontainer cell=main lang=julia ><pre class=codecell cell=main lang=julia ><code>method3 = ImageClassification(
    classes, (100, 128),
    aug_projection=augs_projection(), aug_image=augs_lighting())
xs3, ys3 = FastAI.makebatch(method3, data, fill(4, 9))
FastAI.plotbatch(method3, xs3, ys3)
</code></pre><pre class=coderesult ><code>LoadError("string", 5, MethodError(DataLoaders._batchsize, (Float32[-1.8267832 -1.8267832 … -0.2170563 -0.38830382; -1.8267832 -1.8267832 … -0.55955136 -0.5424266; … ; -1.8267832 -1.8267832 … 0.8446785 1.0673003; -1.8267832 -1.8267832 … 0.86180323 0.96455175]

Float32[-1.8081232 -1.8081232 … -0.93277305 -0.9677871; -1.8081232 -1.8081232 … -1.265406 -1.1428571; … ; -1.8081232 -1.8081232 … -1.0203081 -0.740196; -1.8081232 -1.8081232 … -1.0728291 -0.810224]

Float32[-1.5952941 -1.5952941 … -0.7586928 -0.79355115; -1.5952941 -1.5952941 … -1.0549891 -0.91555554; … ; -1.5952941 -1.5952941 … -0.8458387 -0.67154676; -1.5952941 -1.5952941 … -0.9504139 -0.8109804]

Float32[1.1700488 1.0673003 … 2.2489083 2.2489083; 1.015926 0.9816765 … 2.2489083 2.2489083; … ; 2.2317834 2.0434113 … 2.1804092 2.1804092; 2.1632845 1.9406626 … 2.2489083 2.2146587]

Float32[0.15266106 0.082633056 … 2.4285715 2.4285715; 0.082633056 0.0126050515 … 2.4285715 2.4285715; … ; 1.4306723 1.3431373 … 2.3235295 2.3235295; 1.3781513 1.2556022 … 2.4110641 2.3760502]

Float32[-0.009237396 -0.16610013 … 2.64 2.64; -0.23581691 -0.28810447 … 2.64 2.64; … ; 1.0539435 0.9319392 … 2.6051416 2.64; 0.8970808 0.7576472 … 2.64 2.64]

Float32[1.5467933 1.4097953 … 1.2385478 1.2556726; 1.4954191 1.4097953 … 1.2385478 1.2899221; … ; -2.117904 -2.117904 … 0.4850587 0.74193; -2.117904 -2.117904 … 0.60493195 0.74193]

Float32[1.7983193 1.6232493 … 1.4306723 1.4481792; 1.7457983 1.6232493 … 1.4131653 1.4481792; … ; -2.0357141 -2.0357141 … -1.12535 -0.93277305; -2.0357141 -2.0357141 … -1.1428571 -1.0728291]

Float32[1.907974 1.8208281 … 1.6291069 1.6465361; 1.8556864 1.8033988 … 1.6116778 1.6465361; … ; -1.8044444 -1.8044444 … -1.5430065 -1.4210021; -1.8044444 -1.8044444 … -1.3687146 -1.3338562]

Float32[1.42692 1.4440448 … 1.9920369 2.0091617; 1.6837914 1.6152923 … 1.9064132 1.9064132; … ; 2.2489083 2.2489083 … 1.923538 1.9064132; 2.2489083 2.2489083 … 1.8892884 1.7865399]

Float32[0.64285725 0.5903362 … 2.0784314 2.0959384; 0.9754903 0.83543426 … 1.9558823 1.9558823; … ; 2.4285715 2.4285715 … 1.8858544 1.9383754; 2.4285715 2.4285715 … 1.8683473 1.8508403]

Float32[0.6705013 0.65307206 … 2.169412 2.186841; 1.0713727 0.91451 … 2.0648367 2.0648367; … ; 2.64 2.64 … 1.7859696 1.9254032; 2.64 2.64 … 1.8208281 1.8556864]

Float32[0.94742703 1.0844251 … 1.3926706 1.3926706; 0.96455175 0.96455175 … 1.4440448 1.42692; … ; -2.117904 -2.117904 … 0.9816765 0.878928; -2.117904 -2.117904 … 0.96455175 0.96455175]

Float32[1.1855743 1.0980393 … 1.7282913 1.7282913; 0.9929972 0.71288526 … 1.7633053 1.7457983; … ; -2.0357141 -2.0357141 … 0.4677872 0.71288526; -2.0357141 -2.0357141 … 0.45028022 0.83543426]

Float32[1.0888019 0.94936836 … 2.0474076 2.0474076; 0.8796516 0.6182137 … 2.1171243 2.0996952; … ; -1.8044444 -1.8044444 … 0.13019615 0.40906325; -1.8044444 -1.8044444 … 0.13019615 0.51363856]

Float32[-1.8610327 -1.8610327 … 1.4440448 1.4782944; -1.8610327 -1.8610327 … 1.4611696 1.4611696; … ; 1.3412963 1.4440448 … 1.5467933 -1.8610327; 0.8446785 1.5467933 … 1.5467933 -1.8610327]

Float32[-1.8256302 -1.8256302 … 1.5182073 1.5007002; -1.8256302 -1.8256302 … 1.5182073 1.5357143; … ; 1.1680672 1.2030813 … 1.6057423 -1.8256302; 0.5203082 1.3431373 … 1.6057423 -1.8256302]

Float32[-1.6127234 -1.6127234 … 1.6116778 1.6116778; -1.6127234 -1.6127234 … 1.5768193 1.5768193; … ; 1.541961 1.6813945 … 1.733682 -1.6127234; 0.7925056 1.6291069 … 1.733682 -1.6127234]

Float32[-2.117904 -2.117904 … 0.93030226 0.74193; -2.117904 -2.117904 … 0.96455175 0.94742703; … ; 0.1939379 0.1939379 … 1.1529241 1.0673003; 0.34806067 0.2281874 … 1.1015497 1.0501755]

Float32[-2.0357141 -2.0357141 … 1.1330533 0.95798326; -2.0357141 -2.0357141 … 1.1680672 1.1505603; … ; -0.44257697 -0.495098 … 1.3606442 1.2731093; -0.42507 -0.53011197 … 1.3081232 1.2556022]

Float32[-1.8044444 -1.8044444 … 1.2979523 1.1236603; -1.8044444 -1.8044444 … 1.3153814 1.3153814; … ; -0.41010883 -0.4623964 … 1.6116778 1.5245317; -0.37525046 -0.54954237 … 1.5768193 1.5245317]

Float32[-1.6384109 -1.6384109 … 1.5639181 1.5639181; -1.6384109 -1.6384109 … 0.7590547 1.6152923; … ; -1.6384109 -1.6384109 … -0.02868402 -0.08005828; -1.6384109 -1.6384109 … -0.06293353 0.1939379]

Float32[-1.6505601 -1.6505601 … 1.5007002 1.4831933; -1.6505601 -1.6505601 … 0.5903362 1.3956583; … ; -1.6505601 -1.6505601 … -0.42507 -0.60014; -1.6505601 -1.6505601 … -0.512605 -0.30252096]

Float32[-1.4558606 -1.4558606 … 1.4373858 1.4373858; -1.4558606 -1.4558606 … 0.44392177 1.2108063; … ; -1.4558606 -1.4558606 … -0.35782126 -0.514684; -1.4558606 -1.4558606 … -0.39267966 -0.23581691]

Float32[1.7180408 1.7351656 … 2.1975338 2.2317834; 1.6837914 1.6495419 … 2.1975338 2.2146587; … ; 1.5467933 1.4611696 … 1.42692 1.3241715; 1.3070468 1.3926706 … 1.4611696 1.4097953]

Float32[1.8858544 1.9033613 … 2.4110641 2.4285715; 1.8508403 1.8158263 … 2.4110641 2.4110641; … ; 1.7107843 1.5882353 … 1.5882353 1.5707283; 1.5532213 1.6582633 … 1.6582633 1.5882353]

Float32[2.0125492 2.0299783 … 2.6051416 2.64; 2.0299783 1.9951199 … 2.6051416 2.64; … ; 1.8905448 1.7511113 … 1.6465361 1.7162529; 1.7685405 1.8208281 … 1.6988237 1.7511113],), 0x0000000000007613))</code></pre></div><h2 id=augmentation-in-custom-learning-methods >Augmentation in custom learning methods</h2><p>To use projective and image augmentations in custom learning methods for computer vision tasks, see <a href=../../REFERENCE/FastAI.ProjectiveTransforms.html ><code>ProjectiveTransforms</code></a> and <a href=../../REFERENCE/FastAI.ImagePreprocessing.html ><code>ImagePreprocessing</code></a>, two helpers that every vision method in FastAI.jl uses.</p></article><footer class=book-footer ></footer></div><aside class=book-toc ><nav id=toc class=book-toc-content ><ul><li><a href=#how-to-augment-vision-data >How to augment vision data</a><ul><li><a href=#augmentation-in-custom-learning-methods >Augmentation in custom learning methods</a><ul></ul></li></ul></li></ul></nav></aside></main></body></HTML>