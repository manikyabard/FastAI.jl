<HTML><head><title>How to augment vision data</title><link href=../../template/hugobook.css rel=stylesheet ></link><link href=../../template/ansi.css rel=stylesheet ></link><meta content=Type=text/html; charset=utf-8 http-equiv=Content-Type ></meta></head><body><input onclick=toggleMenu() id=menu-control class=hidden toggle type=checkbox ></input><input id=toc-control type=checkbox class=hidden toggle ></input><main class=container flex ><aside id=menu-container class=book-menu ><nav class=book-menu-content ><h2 id=title >FastAI.jl</h2><div id=sidebar ><div class=doctree ><body><ul><li><p><a href=../../README.md.html title= >README</a></p></li><li><p><a href=../setup.md.html title= >Setup</a></p></li><li><p><a href=../quickstart.md.html title= >Quickstart</a></p></li><li><p>Tutorials</p><ul><li><p><a href=../introduction.md.html title= >Introduction</a></p></li><li><p><a href=../data_containers.md.html title= >Data containers</a></p></li><li><p><a href=../learning_methods.md.html title= >Learning methods</a></p></li><li><p><a href=../../notebooks/serialization.ipynb.html title= >Saving and loading models</a></p></li><li><p><a href=../../tutorials/presizing.ipynb.html title= >Presizing vision datasets</a></p></li></ul></li><li><p>Learning tasks</p><ul><li><p><a href=../methods/imageclassification.md.html title= >Image classification</a></p></li><li><p><a href=../../notebooks/imagesegmentation.ipynb.html title= >Image segmentation</a></p></li><li><p><a href=../../notebooks/keypointregression.ipynb.html title= >Keypoint regression</a></p></li></ul></li><li><p>How To</p><ul><li><p><a href=../../notebooks/fitonecycle.ipynb.html title= >Train a model from scratch</a></p></li><li><p><a href=../../notebooks/finetune.ipynb.html title= >Finetune a pretrained model</a></p></li><li><p><a href=../../notebooks/lrfind.ipynb.html title= >Find a good learning rate</a></p></li><li><p><a href=augmentvision.md.html title= >Augment vision data</a></p></li><li><p><a href=../../notebooks/how_to_visualize.ipynb.html title= >Visualize data</a></p></li><li><p><a href=logtensorboard.md.html title= >Log to TensorBoard</a></p></li></ul></li><li><p>Reference</p><ul><li><p><a href=../../REFERENCE.html title= >Docstrings</a></p></li><li><p><a href=../interfaces.md.html title= >Interfaces</a></p></li><li><p><a href=../api.md.html title= >API</a></p></li><li><p><a href=../glossary.md.html title= >Glossary</a></p></li></ul></li><li><p>Background</p><ul><li><p><a href=../background/datapipelines.md.html title= >Performant data pipelines</a></p></li></ul></li></ul></body></div></div></nav></aside><div class=book-page ><header class=book-header ></header><article><h1 id=how-to-augment-vision-data >How to augment vision data</h1><p>Data augmentation is important to train models with good generalization ability, especially when the size of your dataset is limited. FastAI.jl gives you high-level helpers to use data augmentation in vision learning methods, but also allows directly using <a href=https://github.com/lorenzoh/DataAugmentation.jl title= >DataAugmentation.jl</a>, the underlying data augmentation library.</p><p>By default, the only augmentation that will be used in computer vision tasks is a random crop, meaning that after images, keypoints and masks are resized to a similar size a random portion will be cropped during training. We can demonstrate this on the image classification task.</p><div result=false output=false class=cellcontainer cell=main lang=julia ><pre result=false output=false class=codecell cell=main lang=julia ><code>using FastAI
using CairoMakie; CairoMakie.activate!(type=&quot;png&quot;)

dir = joinpath(datasetpath(&quot;dogscats&quot;), &quot;train&quot;)
data = loadtaskdata(dir, ImageClassification)
classes = Datasets.getclassesclassification(dir)
method = ImageClassification(classes, (100, 128))
xs, ys = FastAI.makebatch(method, data, fill(4, 9))
FastAI.plotbatch(method, xs, ys)
</code></pre></div><p>Most learning methods let you pass additional augmentations as keyword arguments. For example, <code>ImageClassification</code> takes the <code>aug_projection</code> and <code>aug_image</code> arguments. FastAI.jl provides the <a href=../../REFERENCE/FastAI.augs_projection.html ><code>augs_projection</code></a> helper to quickly construct a set of projective data augmentations.</p><div class=cellcontainer cell=main lang=julia ><pre class=codecell cell=main lang=julia ><code>method2 = ImageClassification(classes, (100, 128), aug_projection=augs_projection())
xs2, ys2 = FastAI.makebatch(method2, data, fill(4, 9))
f = FastAI.plotbatch(method2, xs2, ys2)
</code></pre><pre class=coderesult ><code>LoadError("string", 3, MethodError(DataLoaders._batchsize, (Float32[1.2042983 1.1871736 … 1.4782944 1.5639181; 0.673431 0.86180323 … 1.4954191 1.6152923; … ; -2.117904 -2.117904 … 1.7865399 1.7694151; -2.117904 -2.117904 … 1.8892884 1.8721637]

Float32[1.1505603 1.1155462 … 1.4656863 1.6757703; 0.4677872 0.6603642 … 1.3081232 1.5182073; … ; -2.0357141 -2.0357141 … 2.0259104 1.9908963; -2.0357141 -2.0357141 … 2.1659663 2.1484594]

Float32[1.2456646 1.2108063 … 1.2630938 1.454815; 0.42649257 0.6182137 … 1.0365143 1.2282355; … ; -1.8044444 -1.8044444 … 2.0474076 2.0125492; -1.8044444 -1.8044444 … 2.2216995 2.2042704]

Float32[1.9749122 1.923538 … 1.5981677 1.5981677; 2.0947855 2.0262864 … 1.5981677 1.5981677; … ; 1.0330508 1.1015497 … 1.5296686 1.5639181; 1.1700488 0.878928 … 1.5467933 1.5639181]

Float32[2.2184873 2.235994 … 1.7107843 1.7107843; 2.3410363 2.3235295 … 1.6932774 1.7107843; … ; -0.512605 -0.617647 … 1.6757703 1.6757703; -0.512605 -0.757703 … 1.6757703 1.6757703]

Float32[2.4482791 2.4831376 … 1.8208281 1.8033988; 2.5877128 2.5877128 … 1.8731157 1.8208281; … ; -0.8981263 -0.9852723 … 1.8208281 1.7859696; -0.8981263 -1.229281 … 1.8208281 1.8033988]

Float32[-2.117904 -2.117904 … 0.5364329 0.8960528; -2.117904 -2.117904 … 0.41655967 0.86180323; … ; -2.117904 -2.117904 … 1.221423 1.2727973; -2.117904 -2.117904 … 1.3412963 1.2556726]

Float32[-2.0357141 -2.0357141 … -0.039915953 0.2577032; -2.0357141 -2.0357141 … -0.039915953 0.3102242; … ; -2.0357141 -2.0357141 … -0.30252096 -0.14495796; -2.0357141 -2.0357141 … -0.17997196 -0.14495796]

Float32[-1.8044444 -1.8044444 … 0.008191798 0.37420484; -1.8044444 -1.8044444 … -0.07895417 0.35677567; … ; -1.8044444 -1.8044444 … -0.82840955 -0.68897593; -1.8044444 -1.8044444 … -0.7064052 -0.68897593]

Float32[1.3241715 1.2727973 … -2.117904 -2.117904; 1.5639181 1.3070468 … -2.117904 -2.117904; … ; -2.117904 -2.117904 … -2.117904 -2.117904; -2.117904 -2.117904 … -2.117904 -2.117904]

Float32[1.2380953 1.0280112 … -2.0357141 -2.0357141; 1.5882353 1.1155462 … -2.0357141 -2.0357141; … ; -2.0357141 -2.0357141 … -2.0357141 -2.0357141; -2.0357141 -2.0357141 … -2.0357141 -2.0357141]

Float32[1.3328106 1.0190852 … -1.8044444 -1.8044444; 1.6291069 1.0713727 … -1.8044444 -1.8044444; … ; -1.8044444 -1.8044444 … -1.8044444 -1.8044444; -1.8044444 -1.8044444 … -1.8044444 -1.8044444]

Float32[1.42692 1.5981677 … 1.8721637 1.8379141; 1.1186745 1.1357993 … 1.8892884 1.8550389; … ; 1.3755459 1.42692 … 1.8721637 1.8721637; 1.42692 1.3412963 … 1.8550389 1.8721637]

Float32[0.4327732 0.6603642 … 2.0434172 2.0084033; -0.092436954 0.0126050515 … 2.0609243 2.0259104; … ; 0.9929972 0.87044823 … 2.1134453 2.1134453; 0.94047624 0.6603642 … 2.0959384 2.1134453]

Float32[0.68793046 0.98422676 … 2.2216995 2.186841; 0.35677567 0.5310677 … 2.2391288 2.2042704; … ; 0.5833553 0.44392177 … 2.3785625 2.3785625; 0.65307206 0.42649257 … 2.3611329 2.3785625]

Float32[0.72480524 0.69055575 … -2.117904 -2.117904; 1.1015497 1.015926 … -2.117904 -2.117904; … ; 1.4954191 1.42692 … -2.117904 -2.117904; 1.4954191 1.4440448 … -2.117904 -2.117904]

Float32[-0.21498597 -0.21498597 … -2.0357141 -2.0357141; 0.2577032 0.2226892 … -2.0357141 -2.0357141; … ; 1.6582633 1.6057423 … -2.0357141 -2.0357141; 1.6582633 1.5532213 … -2.0357141 -2.0357141]

Float32[0.13019615 0.008191798 … -1.8044444 -1.8044444; 0.5484969 0.33934647 … -1.8044444 -1.8044444; … ; 1.8033988 1.733682 … -1.8044444 -1.8044444; 1.8382572 1.7859696 … -1.8044444 -1.8044444]

Float32[1.3926706 1.4440448 … 0.9816765 1.3070468; 1.42692 1.4440448 … 1.0844251 1.2385478; … ; 0.74193 1.5639181 … 2.0776608 2.0776608; 0.96455175 1.4611696 … 2.0947855 2.0947855]

Float32[1.5532213 1.6057423 … -0.07492995 0.3452382; 1.5882353 1.6057423 … 0.11764706 0.3802522; … ; 0.29271722 1.4131653 … 2.2535014 2.2535014; 0.71288526 1.3956583 … 2.2710083 2.2710083]

Float32[1.733682 1.7859696 … -0.009237396 0.39163405; 1.7685405 1.7859696 … 0.23477131 0.46135095; … ; 0.5310677 1.6465361 … 2.4308496 2.4308496; 0.9319392 1.6639653 … 2.4482791 2.4482791]

Float32[2.2146587 2.2146587 … -0.19993155 -0.31980482; 2.11191 2.11191 … -0.4739276 -0.23418105; … ; 1.3241715 1.1700488 … 1.9920369 1.9577874; 1.3755459 1.3412963 … 1.9749122 2.0091617]

Float32[2.4285715 2.4285715 … -0.810224 -0.93277305; 2.3760502 2.3760502 … -1.0203081 -0.757703; … ; 1.3956583 1.2380953 … 2.2184873 2.1834733; 1.4481792 1.3606442 … 2.2009804 2.1659663]

Float32[2.6051416 2.6051416 … -0.86326796 -0.9678431; 2.6051416 2.5877128 … -1.1247058 -0.8458387; … ; 1.733682 1.4722441 … 2.465708 2.5528543; 1.6465361 1.4722441 … 2.5528543 2.535425]

Float32[-2.117904 -2.117904 … 1.5296686 1.4782944; -2.117904 -2.117904 … 1.4611696 1.3070468; … ; -2.117904 -2.117904 … -2.117904 -2.117904; -2.117904 -2.117904 … -2.117904 -2.117904]

Float32[-2.0357141 -2.0357141 … 0.83543426 0.81792724; -2.0357141 -2.0357141 … 0.7303922 0.6078432; … ; -2.0357141 -2.0357141 … -2.0357141 -2.0357141; -2.0357141 -2.0357141 … -2.0357141 -2.0357141]

Float32[-1.8044444 -1.8044444 … 0.49620935 0.56592613; -1.8044444 -1.8044444 … 0.35677567 0.2870589; … ; -1.8044444 -1.8044444 … -1.8044444 -1.8044444; -1.8044444 -1.8044444 … -1.8044444 -1.8044444],), 0x0000000000007607))</code></pre></div><p>Likewise, there is an <a href=../../REFERENCE/FastAI.augs_lighting.html ><code>augs_lighting</code></a> helper that adds contrast and brightness augmentation:</p><div class=cellcontainer cell=main lang=julia ><pre class=codecell cell=main lang=julia ><code>method3 = ImageClassification(
    classes, (100, 128),
    aug_projection=augs_projection(), aug_image=augs_lighting())
xs3, ys3 = FastAI.makebatch(method3, data, fill(4, 9))
FastAI.plotbatch(method3, xs3, ys3)
</code></pre><pre class=coderesult ><code>LoadError("string", 5, MethodError(DataLoaders._batchsize, (Float32[0.69055575 0.63918144 … 2.0776608 2.0776608; 0.45080918 0.63918144 … 2.0776608 2.0776608; … ; 1.0844251 0.9988013 … 1.4440448 1.4440448; 0.82755375 1.2385478 … 1.4440448 1.4440448]

Float32[0.41526622 0.047619052 … 2.2535014 2.2535014; 0.082633056 -0.057422955 … 2.2535014 2.2535014; … ; -0.109943956 -0.00490195 … 1.5357143 1.5357143; -0.37254897 0.2401962 … 1.5357143 1.5357143]

Float32[0.35677567 0.16505454 … 2.465708 2.465708; 0.043050185 0.09533776 … 2.465708 2.465708; … ; -0.39267966 -0.21838771 … 1.6988237 1.6988237; -0.7064052 -0.061524976 … 1.6988237 1.6988237]

Float32[-1.4671633 -1.4671633 … 0.3651854 0.39943492; -1.4671633 -1.4671633 … 0.6563062 0.8960528; … ; -1.4671633 -1.4671633 … 1.8550389 2.2489083; -1.4671633 -1.4671633 … 2.2489083 2.2489083]

Float32[-1.5105042 -1.5105042 … -0.23249297 -0.33753496; -1.5105042 -1.5105042 … -0.07492995 0.11764706; … ; -1.5105042 -1.5105042 … 1.3256303 2.1484594; -1.5105042 -1.5105042 … 1.9383754 2.2535014]

Float32[-1.3338562 -1.3338562 … -0.37525046 -0.47982562; -1.3338562 -1.3338562 … -0.34039208 -0.13124175; … ; -1.3338562 -1.3338562 … 1.193377 1.9776908; -1.3338562 -1.3338562 … 1.8382572 2.0996952]

Float32[1.1529241 0.9816765 … 1.7522904 1.7522904; 0.86180323 1.0501755 … 1.7522904 1.7522904; … ; 1.4782944 1.5467933 … -2.117904 -2.117904; 1.4954191 1.4611696 … -2.117904 -2.117904]

Float32[0.2401962 0.065126054 … 1.9208683 1.9208683; -0.039915953 0.13515405 … 1.9208683 1.9208683; … ; 0.4677872 0.5903362 … -2.0357141 -2.0357141; 0.3977592 0.4677872 … -2.0357141 -2.0357141]

Float32[0.3044881 0.11276696 … 2.0996952 2.0996952; -0.009237396 0.13019615 … 2.0996952 2.0996952; … ; 0.33934647 0.44392177 … -1.8044444 -1.8044444; 0.35677567 0.42649257 … -1.8044444 -1.8044444]

Float32[1.6495419 1.6152923 … 1.8550389 1.6837914; 1.6495419 1.6152923 … 1.4782944 1.4954191; … ; 1.7009162 1.7351656 … 1.0501755 0.8960528; 1.7009162 1.7522904 … 1.221423 1.0330508]

Float32[1.9033613 1.9033613 … 1.3431373 1.0455183; 1.8683473 1.9208683 … 1.1155462 1.0105042; … ; 1.9208683 1.9383754 … -0.582633 -0.705182; 1.9208683 1.9558823 … -0.42507 -0.582633]

Float32[1.4373858 1.3328106 … 1.2805231 1.0365143; 1.5071026 1.367669 … 0.9667976 0.94936836; … ; 2.0648367 2.0822659 … -1.0375599 -1.229281; 2.0648367 2.1171243 … -0.9852723 -1.1421349]

Float32[2.0434113 2.0947855 … 2.11191 2.11191; 1.9749122 2.0262864 … 2.129035 2.129035; … ; 1.8379141 1.7694151 … 1.6152923 1.015926; 1.8207895 1.7694151 … 1.8036647 1.5810429]

Float32[2.2184873 2.2710083 … 2.4285715 2.4285715; 2.1484594 2.2009804 … 2.4285715 2.4285715; … ; 1.9208683 1.9558823 … 1.7808123 1.0630252; 1.9033613 1.9558823 … 1.8508403 1.4131653]

Float32[2.5005665 2.535425 … 2.64 2.64; 2.4308496 2.4831376 … 2.64 2.64; … ; 2.0299783 2.0474076 … 1.907974 1.3328106; 2.0125492 2.0474076 … 2.0648367 1.6639653]

Float32[1.6666666 1.7865399 … 1.1700488 1.221423; 1.6324171 1.7009162 … 1.221423 1.1871736; … ; 1.3584211 1.3070468 … 1.2385478 1.1186745; 1.3584211 1.3070468 … 1.2556726 1.1700488]

Float32[1.8508403 1.9733893 … 1.2205883 1.3081232; 1.8158263 1.8858544 … 1.2205883 1.1680672; … ; 1.6232493 1.5882353 … 0.50280124 0.4677872; 1.6582633 1.5882353 … 0.62535024 0.6078432]

Float32[2.1345534 2.2216995 … 1.2108063 1.3153814; 2.0996952 2.1345534 … 1.1236603 1.1759479; … ; 1.9428324 1.8731157 … 0.18248373 0.16505454; 1.9602616 1.8731157 … 0.39163405 0.35677567]

Float32[0.810429 0.5535577 … -2.117904 -2.117904; 0.72480524 0.4850587 … -2.117904 -2.117904; … ; 1.5467933 1.42692 … -2.117904 -2.117904; 1.4954191 1.3926706 … -2.117904 -2.117904]

Float32[0.047619052 -0.14495796 … -2.0357141 -2.0357141; -0.14495796 -0.26750696 … -2.0357141 -2.0357141; … ; 1.3431373 1.1505603 … -2.0357141 -2.0357141; 1.2906163 1.0105042 … -2.0357141 -2.0357141]

Float32[-0.14867094 -0.2706753 … -1.8044444 -1.8044444; -0.30553368 -0.37525046 … -1.8044444 -1.8044444; … ; 0.98422676 0.8622224 … -1.8044444 -1.8044444; 1.0190852 0.8622224 … -1.8044444 -1.8044444]

Float32[0.93030226 0.8960528 … 1.1871736 1.1700488; 0.8446785 0.8960528 … 1.1700488 1.1529241; … ; -2.117904 -2.117904 … 0.9131775 0.7761795; -2.117904 -2.117904 … 0.86180323 0.7761795]

Float32[0.3452382 0.18767506 … 1.3956583 1.3956583; 0.17016806 0.11764706 … 1.3956583 1.3781513; … ; -2.0357141 -2.0357141 … 0.3102242 0.48529422; -2.0357141 -2.0357141 … 0.3102242 0.5203082]

Float32[0.13019615 0.043050185 … 1.6639653 1.6465361; -0.11381256 -0.061524976 … 1.6465361 1.6291069; … ; -1.8044444 -1.8044444 … 0.025620991 0.18248373; -1.8044444 -1.8044444 … 0.008191798 0.21734212]

Float32[1.1186745 1.2042983 … 0.9988013 0.9131775; 1.1015497 1.221423 … 0.94742703 0.9131775; … ; 1.1186745 1.1015497 … 1.015926 0.96455175; 1.0844251 1.0844251 … 1.0501755 1.0330508]

Float32[1.2731093 1.3781513 … 1.1680672 1.0805323; 1.2556022 1.3956583 … 1.0980393 1.0805323; … ; 1.2556022 1.2380953 … 1.1680672 1.1155462; 1.2205883 1.2205883 … 1.2030813 1.2030813]

Float32[1.4722441 1.5768193 … 1.3328106 1.2282355; 1.4722441 1.5768193 … 1.2805231 1.2282355; … ; 1.4373858 1.4199566 … 1.4025275 1.367669; 1.4025275 1.4025275 … 1.454815 1.454815],), 0x0000000000007607))</code></pre></div><h2 id=augmentation-in-custom-learning-methods >Augmentation in custom learning methods</h2><p>To use projective and image augmentations in custom learning methods for computer vision tasks, see <a href=../../REFERENCE/FastAI.ProjectiveTransforms.html ><code>ProjectiveTransforms</code></a> and <a href=../../REFERENCE/FastAI.ImagePreprocessing.html ><code>ImagePreprocessing</code></a>, two helpers that every vision method in FastAI.jl uses.</p></article><footer class=book-footer ></footer></div><aside class=book-toc ><nav id=toc class=book-toc-content ><ul><li><a href=#how-to-augment-vision-data >How to augment vision data</a><ul><li><a href=#augmentation-in-custom-learning-methods >Augmentation in custom learning methods</a><ul></ul></li></ul></li></ul></nav></aside></main></body></HTML>